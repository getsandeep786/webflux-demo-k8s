# webflux-demo-k8s
Deploying a sample reactive application to Kubernetes(minikube) cluster using helm charts

# Minikube
	It is an open-source tool for local Kubernatives cluster setup.
	All the master(4 processes) and slave(3 processes) node is installed in the local machine.
	Minikube is one Node/Machine for testing purposes(testing K8s cluster in local).
	
# Commands Used

gradle clean build

minikube start

minikube start --cpus 6 --memory 8192

minikube dashboard

minikube stop

kubectl version

kubectl cluster-info

kubectl get nodes

kubectl get pods

kubectl get pods -n istio-system

kubectl get ns

kubectl get all --namespace test1-name-space

kubectl get services

kubectl -h

kubectl create -h

kubectl create deployment mongo-depl --image=mongo

kubectl get deployment

kubectl describe pods mongo-depl-88767676-djh56sh-jg
	If any issue occurs while starting the pod container(eg: authentication denied to pull docker image, etc), we can use describe command to check what the exact error was

kubectl edit deployment mongo-depl
	We will get and autogenerated configuration file(.yaml)
	
kubectl delete deployment mongo-depl

kubectl get deployment.apps/sample-app-ci-0.0.1-a-1677 -n test1-name-space -o yaml

kubectl get service/sample-app-service-ci -n test1-name-space -o yaml

kubectl get pod -0 wide

kubectl get replicaset

kubectl logs {pod_NAME}
------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Open Bash Terminal
kubectl exec -it {pod_NAME} --bash/bin

kubectl exec -it webflux-app-deployment-6b78c46495-4z45m --bash/bin

kubectl exec --stdin --tty webflux-app-deployment-6b78c46495-4z45m -- sh
------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Apply/Delete command
kubectl apply -f {filename}

An apply takes the configuration file(.yaml) as parameter and does whatever mentioned/written in the file
kubectl apply -f sample-deployment-config-file.yaml

If anything updated in the file, K8s know when to create/update the deployment based on file.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
kubectl delete -f mongo-service.yaml
	Used to delete the K8s component
	
------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Helm Commands
helm create <chart_name>

helm/
	Chart.yaml - metadata info about charts like chart name, version and dependencies, etc
	values.yaml
	charts/ folder for chart dependencies
	template/ folder for actual template(component) files. It usually contains Deployment.yaml and Service.yaml
	
helm install <chart_name>
	Template files will be filled with values from value.yaml

helm install --values=my-values.yaml <chart_name>

To check all our helm files are good, use the below command
helm lint ./<chart_name>/

To check our yaml files
helm install --dry-run --debug ./<chart_name>/ --generate-name

[or]

helm template sample-chart-name <chart_name>

helm update chart-name <chart_name>

helm list

# Istio Commands

istioctl install

kubectl get pod -n istio-system

kubectl get ns default --show-labels

kubectl label namespace default istio-injection=enabled

//installs istio integrations addons

kubectl apply -f C:\istio-1.17.2\samples\addons

kubectl port-forward svc/<service-name> -n <service-namespace> 20001
  
# Docker command to build and push image to docker registry

docker build -t webflux-app-demo .

docker tag webflux-app-demo getsandeep786/k8s_demo:webflux-app-demo

docker push getsandeep786/k8s_demo:webflux-app-demo

helm lint ./webflux-demo

helm install --dry-run --debug ./webflux-demo/ --generate-name

helm install ./webflux-demo --generate-name

NAME: webflux-demo-1684757297
LAST DEPLOYED: Mon May 22 17:38:17 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w webflux-demo-1684757297'
  export SERVICE_IP=$(kubectl get svc --namespace default webflux-demo-1684757297 --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:80
  

helm list
  
helm delete webflux-demo-1684757297

kubectl describe pods webflux-app-deployment

minikube service webflux-app-service
